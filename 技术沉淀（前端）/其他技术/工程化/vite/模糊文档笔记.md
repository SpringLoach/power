### vite

模块热重载 预先配置

TypeScript 天然支持

支持vue [插件](https://vitejs.cn/guide/features.html#vue)

JSX、tsx 开箱即用

支持 jsx 的 vue3 特性 [插件](https://vitejs.cn/guide/features.html#jsx)

从文件系统[导入](https://vitejs.cn/guide/features.html#glob-import)多个模块 import.meta.glob



默认的构建优化

代码分割 自动地将异步 chunk 模块中使用到的 CSS 代码抽取出来，生成单独的文件

预加载 对入口 chunk 自动生成  `<link rel="modulepreload">`

异步 Chunk 加载优化 对于被多个 chunk 共用的其他 chunk，Rollup 容易导致额外网络往返，Vite 能够消除



使用插件

[添加插件](https://vitejs.cn/guide/using-plugins.html#adding-a-plugin)、控制插件排序、提供按需应用的语法



文件系统缓存 会缓存预构建的依赖，需要强制重新构建依赖，可以手动删除 `node_modules/.vite` 目录

文件系统缓存 重构前提，以下任一发生变化：package.json 中的 dependencies；包管理器的锁定版本、vite.config.js





常见的图像、媒体和字体文件类型被自动检测为资源 使用 [assetsInclude](https://vitejs.cn/config/#assetsinclude) 选项扩展内部列表

较小的资源体积会被内联为 base64 使用 [assetsInlineLimit](https://vitejs.cn/config/#build-assetsinlinelimit) 选项配置阈值



显性引入资源

不在内部列表及选项扩展的资源，可以添加后缀 `?url`

```javascript
import workletURL from 'extra-scalloped-border/worklet.js?url'
```



作为字符串引入

资源作为字符串引入，可以添加后缀 `?raw` 

```javascript
import shaderString from './shader.glsl?raw'
```



导入脚本作为 worker

可以添加后缀 `?worker` 

```
import Worker from './shader.js?worker'
```





public 目录 放一些不会被hash处理文件名、不被源码引入的文件

public 目录 通过 [publicDir](https://vitejs.cn/config/#publicdir) 配置目录位置

[new URL](https://vitejs.cn/guide/assets.html#new-url-url-import-meta-url) 在开发/生产模式得到静态资源正确的地址

默认不包含任何polyfill 支持传统浏览器 [@vitejs/plugin-legacy](https://github.com/vitejs/vite/tree/main/packages/plugin-legacy)



配置文件解析

以命令行方式运行 `vite` 时，会自动解析根目录下的 `vite.config.js` 文件

可以显式地通过 `--config` 命令行选项指定一个配置文件



使用 `defineConfig` 工具函数，可以获取类型提示 配置智能提示

```
import { defineConfig } from 'vite'

export default defineConfig({
  // ...
})
```



可以根据模式使用不同配置/在有需求的前提下使用异步配置



| - 配置             | 说明                                              | 默认                                            |
| ------------------ | ------------------------------------------------- | ----------------------------------------------- |
| root               | `index.html` 文件所在的位置                       | process.cwd()                                   |
| base               | 开发或生产环境服务的公共基础路径                  | /                                               |
| mode               | 指明运行模式，一般在命令行指明                    | development / production                        |
| define             | 定义全局常量替换方式                              |                                                 |
| plugins            | 需要用到的插件数组                                |                                                 |
| publicDir          | 静态资源服务的文件夹                              | public                                          |
| cacheDir           | 存储缓存文件的目录                                | node_modules/.vite                              |
| resolve.alias      | 文件系统路径的别名(始终使用绝对路径)              |                                                 |
| resolve.extensions | 导入时想要省略的扩展名列表                        | ['.mjs', '.js', '.ts', '.jsx', '.tsx', '.json'] |
| css.postcss        | 内联的 PostCSS 配置（格式同 `postcss.config.js`） |                                                 |
| server.host        | 指定服务器应该监听的 IP 地址                      | '127.0.0.1'                                     |
| server.port        | 指定开发服务器端口（可用时）                      | 3000                                            |
| server.open        | （开发）启动时自动在浏览器中打开应用程序          |                                                 |
| server.proxy       | 为开发服务器配置自定义代理规则                    |                                                 |

PostCSS ：CSS 界的 Babel 识别一些浏览器尚未支持的语法，转换为浏览器支持的

base

```
// 部署生产环境和开发环境下的URL。
// 默认情况下，vite 会假设你的应用是被部署在一个域名的根路径上
// 例如 https://www.ruoyi.vip/。如果应用被部署在一个子路径上，你就需要用这个选项指定这个子路径。例如，如果你的应用被部署在 https://www.ruoyi.vip/admin/，则设置 baseUrl 为 /admin/。
```



### 别名和拓展名

```javascript
resolve: {
  alias: {
    // 设置路径
    '~': path.resolve(__dirname, './'),
    // 设置别名
    '@': path.resolve(__dirname, './src')
  },
  extensions: ['.mjs', '.js', '.ts', '.jsx', '.tsx', '.json', '.vue']
},
```





## vite的优势

| vite概念 | 说明                                                         |
| -------- | ------------------------------------------------------------ |
| 依赖     | 大多为在开发时不会变动的纯 JavaScript                        |
| 源码     | 通常为非 JavaScript 的文件，需要转换（例如 JSX、CSS、Vue组件），时常编辑 |

- 使用 <span style="color: #a50">esbuild</span> 预构建依赖，它基于 Go，比 JavaScript 编写的打包器预构建依赖快 10-100 倍；

- 只需要在浏览器请求源码时进行转换并按需提供源码（只在当前屏幕上实际使用时才会被处理）。



## 创建项目

### 搭建项目

#### 搭建通用模板

```elm
# npm
npm create vite@latest

# yarn
yarn create vite

# pnpm
pnpm create vite
```

#### 搭建指定模板

构建 Vite + Vue 项目示例，更多模板可见[文档](https://github.com/vitejs/vite/tree/main/packages/create-vite)。

```elm
# npm 6.x
npm create vite@latest my-vue-app --template vue

# npm 7+, extra double-dash is needed:
npm create vite@latest my-vue-app -- --template vue

# yarn
yarn create vite my-vue-app --template vue

# pnpm
pnpm create vite my-vue-app --template vue
```



### index.html

- 该文件处于项目最外层而不是 `public` 文件夹下；
- 该文件中的 `url` 将被自动转换，故不需要 `%PUBLIC_URL%` 占位符。



### 命令行界面

```json
{
  "scripts": {
    "dev": "vite", // 在当前目录下启动 Vite 开发服务器
    "build": "vite build", // 构建生产版本
    "preview": "vite preview" // 本地预览构建产物
  }
}
```

:ghost: 均可以通过[选项](https://cn.vitejs.dev/guide/cli.html)启用额外的配置。



## 功能

使用脚手架创建项目时，预先配置了模块热重载







## 环境变量与模式

### 环境变量

Vite 在  `import.meta.env` 对象上<span style="color: green">暴露环境变量</span>。

部分内建变量

| 内建变量                   | 值类型 | 说明                                                         |
| -------------------------- | ------ | ------------------------------------------------------------ |
| `import.meta.env.MODE`     | str    | 应用运行的模式                                               |
| `import.meta.env.BASE_URL` | str    | 部署应用时的基本 URL，由 [base](https://cn.vitejs.dev/config/shared-options.html#base) 决定 |
| `import.meta.env.PROD`     | boolen | 应用是否运行在生产环境                                       |
| `import.meta.env.DEV`      | boolen | 应用是否运行在开发环境，永远与上面相反                       |

:turtle: 在生产环境中，动态的 key 将失效，如 `import.meta.env[key]`。



### `.env` 文件

```elm
.env                # 所有情况下都会加载
.env.local          # 所有情况下都会加载，但会被 git 忽略
.env.[mode]         # 只在指定模式下加载
.env.[mode].local   # 只在指定模式下加载，但会被 git 忽略
```

:ghost: 指定模式的文件(如 `.env.production`）比通常形式的优先级更高。

#### 变量暴露

> 只有以 `VITE_` 为前缀的变量才会暴露到客户端，可以通过 [envPrefix](https://cn.vitejs.dev/config/shared-options.html#envprefix) 自定义前缀。

定义

```elm
VITE_SOME_KEY=123
DB_PASSWORD=foobar
```

使用

```javascript
console.log(import.meta.env.VITE_SOME_KEY) // 123
console.log(import.meta.env.DB_PASSWORD) // undefined
```



#### 内部引用变量

```elm
KEY=123
NEW_KEY1=test$foo   # test
NEW_KEY2=test\$foo  # test$foo
NEW_KEY3=test$KEY   # test123
```

:turtle: 如果想要在环境变量中使用 `$` 符号，则必须使用 `\` 对其进行转义



### TypeScript 增加智能提示

通过[配置](https://cn.vitejs.dev/guide/env-and-mode.html#intellisense)，可以使新增加的变量，存在  TypeScript 的智能提示。



### 模式

#### 默认情况

| 命令  | 对应情景   | 对应模式 |
| ----- | ---------- | -------- |
| dev   | 开发服务器 | 开发模式 |
| build | 生产       | 生产模式 |

:ghost: 当执行 `vite build` 时，它会自动加载 `.env.production` 中可能存在的环境变量。



#### 自定义模式

```elm
vite build --mode staging
```

:ghost: 可以使用 `--mode` <span style="color: #ff0000">指定模式</span>来覆盖默认模式，这时会去加载 `.env.staging`  文件中的内容。







## 常用插件

| [插件](https://cn.vitejs.dev/plugins/)                       | 说明                                   |
| ------------------------------------------------------------ | -------------------------------------- |
| [@vitejs/plugin-vue](https://github.com/vitejs/vite-plugin-vue/tree/main/packages/plugin-vue) | 提供 Vue 3 单文件组件支持              |
| [@vitejs/plugin-vue-jsx](https://github.com/vitejs/vite-plugin-vue/tree/main/packages/plugin-vue-jsx) | 提供 Vue 3 JSX 支持                    |
| [@vitejs/plugin-vue2](https://github.com/vitejs/vite-plugin-vue2) | 提供 Vue 2 单文件组件支持              |
| [@vitejs/plugin-react](https://github.com/vitejs/vite-plugin-react/tree/main/packages/plugin-react) | ---                                    |
| [@vitejs/plugin-legacy](https://github.com/vitejs/vite/tree/main/packages/plugin-legacy) | 为打包后的文件提供传统浏览器兼容性支持 |

使用示例

<span style="backGround: #efe0b9">vite.config.js</span>

```javascript
import vue from '@vitejs/plugin-vue'

export default {
  plugins: [vue()],
}
```

:whale: 插件的配置方式，均可以点进链接，在官方 github 上查看到；

:whale: 配置多个插件时，插入到 plugins 数组中即可。


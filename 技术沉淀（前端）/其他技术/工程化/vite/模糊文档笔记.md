### vite

模块热重载 预先配置

TypeScript 天然支持

支持vue [插件](https://vitejs.cn/guide/features.html#vue)

JSX、tsx 开箱即用

支持 jsx 的 vue3 特性 [插件](https://vitejs.cn/guide/features.html#jsx)

从文件系统[导入](https://vitejs.cn/guide/features.html#glob-import)多个模块 import.meta.glob



默认的构建优化

代码分割 自动地将异步 chunk 模块中使用到的 CSS 代码抽取出来，生成单独的文件

预加载 对入口 chunk 自动生成  `<link rel="modulepreload">`

异步 Chunk 加载优化 对于被多个 chunk 共用的其他 chunk，Rollup 容易导致额外网络往返，Vite 能够消除



使用插件

[添加插件](https://vitejs.cn/guide/using-plugins.html#adding-a-plugin)、控制插件排序、提供按需应用的语法



文件系统缓存 会缓存预构建的依赖，需要强制重新构建依赖，可以手动删除 `node_modules/.vite` 目录

文件系统缓存 重构前提，以下任一发生变化：package.json 中的 dependencies；包管理器的锁定版本、vite.config.js





常见的图像、媒体和字体文件类型被自动检测为资源 使用 [assetsInclude](https://vitejs.cn/config/#assetsinclude) 选项扩展内部列表

较小的资源体积会被内联为 base64 使用 [assetsInlineLimit](https://vitejs.cn/config/#build-assetsinlinelimit) 选项配置阈值



显性引入资源

不在内部列表及选项扩展的资源，可以添加后缀 `?url`

```javascript
import workletURL from 'extra-scalloped-border/worklet.js?url'
```



作为字符串引入

资源作为字符串引入，可以添加后缀 `?raw` 

```javascript
import shaderString from './shader.glsl?raw'
```



导入脚本作为 worker

可以添加后缀 `?worker` 

```
import Worker from './shader.js?worker'
```





public 目录 放一些不会被hash处理文件名、不被源码引入的文件

public 目录 通过 [publicDir](https://vitejs.cn/config/#publicdir) 配置目录位置

[new URL](https://vitejs.cn/guide/assets.html#new-url-url-import-meta-url) 在开发/生产模式得到静态资源正确的地址

默认不包含任何polyfill 支持传统浏览器 [@vitejs/plugin-legacy](https://github.com/vitejs/vite/tree/main/packages/plugin-legacy)



环境变量  在 import.meta.env 对象上暴露

内建变量

import.meta.env.MODE 应用运行的模式

import.meta.env.BASE_URL 部署应用时的基本 URL，由 [base]() 决定

动态取值无效 如 import.meta.env[key]





```
.env                # 所有情况下都会加载
.env.local          # 所有情况下都会加载，但会被 git 忽略
.env.[mode]         # 只在指定模式下加载
.env.[mode].local   # 只在指定模式下加载，但会被 git 忽略
```

加载的环境变量会通过 `import.meta.env` 暴露给客户端源码

`.env.*.local` 文件应是本地的，可以包含敏感变量



```
DB_PASSWORD=foobar // 通过 import.meta.env.DB_PASSWORD 不可访问
VITE_SOME_KEY=123  // 通过 import.meta.env.VITE_SOME_KEY 可以访问
```

只有以 `VITE_` 为前缀的变量才会暴露给经过 vite 处理的代码



在TS中，为变量[添加提示](https://vitejs.cn/guide/env-and-mode.html#intellisense)



默认清空下，build 和  serve 运行在生产[模式](https://vitejs.cn/guide/env-and-mode.html#modes)，执行 `vite build` 时，自动加载 `.env.production` 

dev 运行在开发环境，运行 `vite` 时，自动加载 `.env.development`

可以运行 `vite build --mode staging`，会同时加载  `.env.production`  和  ` .env.staging`



配置文件解析

以命令行方式运行 `vite` 时，会自动解析根目录下的 `vite.config.js` 文件

可以显式地通过 `--config` 命令行选项指定一个配置文件



使用 `defineConfig` 工具函数，可以获取类型提示 配置智能提示

```
import { defineConfig } from 'vite'

export default defineConfig({
  // ...
})
```



可以根据模式使用不同配置/在有需求的前提下使用异步配置



| - 配置             | 说明                                              | 默认                                            |
| ------------------ | ------------------------------------------------- | ----------------------------------------------- |
| root               | `index.html` 文件所在的位置                       | process.cwd()                                   |
| base               | 开发或生产环境服务的公共基础路径                  | /                                               |
| mode               | 指明运行模式，一般在命令行指明                    | development / production                        |
| define             | 定义全局常量替换方式                              |                                                 |
| plugins            | 需要用到的插件数组                                |                                                 |
| publicDir          | 静态资源服务的文件夹                              | public                                          |
| cacheDir           | 存储缓存文件的目录                                | node_modules/.vite                              |
| resolve.alias      | 文件系统路径的别名(始终使用绝对路径)              |                                                 |
| resolve.extensions | 导入时想要省略的扩展名列表                        | ['.mjs', '.js', '.ts', '.jsx', '.tsx', '.json'] |
| css.postcss        | 内联的 PostCSS 配置（格式同 `postcss.config.js`） |                                                 |
| server.host        | 指定服务器应该监听的 IP 地址                      | '127.0.0.1'                                     |
| server.port        | 指定开发服务器端口（可用时）                      | 3000                                            |
| server.open        | （开发）启动时自动在浏览器中打开应用程序          |                                                 |
| server.proxy       | 为开发服务器配置自定义代理规则                    |                                                 |

PostCSS ：CSS 界的 Babel 识别一些浏览器尚未支持的语法，转换为浏览器支持的

base

```
// 部署生产环境和开发环境下的URL。
// 默认情况下，vite 会假设你的应用是被部署在一个域名的根路径上
// 例如 https://www.ruoyi.vip/。如果应用被部署在一个子路径上，你就需要用这个选项指定这个子路径。例如，如果你的应用被部署在 https://www.ruoyi.vip/admin/，则设置 baseUrl 为 /admin/。
```



### 插件配置示例

```javascript
import vitePlugin from 'vite-plugin-feature'
import rollupPlugin from 'rollup-plugin-feature'

export default defineConfig({
  plugins: [vitePlugin(), rollupPlugin()]
})
```

### 别名和拓展名

```javascript
resolve: {
  alias: {
    // 设置路径
    '~': path.resolve(__dirname, './'),
    // 设置别名
    '@': path.resolve(__dirname, './src')
  },
  extensions: ['.mjs', '.js', '.ts', '.jsx', '.tsx', '.json', '.vue']
},
```


## 通用

### 获取手机号

> 需要获取用户手机号时，流程为在前端获取令牌后，供服务器兑换手机号，再返回给前端。

```html
<button open-type="getPhoneNumber" bindgetphonenumber="getPhoneNumber"></button>
```



```javascript
Page({
  getPhoneNumber (e) {
    console.log(e.detail.code) // 返回的动态令牌，供后端换取用户手机号
  }
})
```



### 允许页面的分享

> [控制](https://developers.weixin.qq.com/miniprogram/dev/api/share/wx.showShareMenu.html)是否显示转发分享菜单在 "...” 菜单中

```javascript
onLoad(options) {
  // 允许分享
  wx.showShareMenu({
    withShareTicket: true,
    // 设置下方的Menus菜单，才能够让发送给朋友与分享到朋友圈两个按钮可以点击
    menus: ['shareAppMessage', 'shareTimeline']
  })
},
```



### 微信订阅消息

> 场景：用户点击立即参团按钮时，弹出该弹框让用户开启订阅。

```javascript
clickBtn() {
  const tmplIds = this.member.tmplIdsSet.group_order_pay_success
  wx.requestSubscribeMessage({
    tmplIds,
    // 接口调用成功，即用户点击了确定/取消后都会执行的逻辑  
    success(res) {}
  })
}
```

:hammer_and_wrench: tmplIds 一般由服务器提供，多处需要用到的话，可以在初始加载（onLaunch）时请求，将数据写入到 vuex/缓存中。



## 地图

### 使用地图选点插件

> [使用](https://lbs.qq.com/miniProgram/plugin/pluginGuide/locationPicker)该插件，提供用户的经纬度即可实现选点功能（可以搜索地点），使用需要[申请](https://www.cnblogs.com/1549983239yifeng/p/14750266.html)密钥。





## 锦囊

### 获取用户信息报 invalid code

`报错信息`

```elm
{"errcode":40029, "errmsg":"invalid code", ...}
```

`出错原因`

1. 由于前端小程序与服务器接口用的 AppID（小程序ID）、AppSecret（小程序密钥） 不一样导致。
2. 重复请求，请求两次导致code失效（<span style="color: #f7534f;font-weight:600">code只能使用一次</span>）。






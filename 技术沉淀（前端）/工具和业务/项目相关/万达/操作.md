## 账号资料

#### 获取前端项目

根据[账号资料](http://starthope.tpddns.cn:8443/!/#iMannings/view/head/iMannings_document/%E5%95%86%E5%8A%A1%E6%96%87%E6%A1%A3/%E8%B4%A6%E5%8F%B7%E8%B5%84%E6%96%99.txt)的第二点，进入git获取前端项目 `manning-cloud-store`，导入后，需要切换到  `feature-order` 分支进行开发

#### 前端项目的安装运行

需要将 `node_modules` 删除后，在命令行中运行 `npm install`，如果报错，再运行 `cnpm install`。运行启动命令后，如果报错，需要重复该过程。

#### 前端页面的权限获取

运行项目后，页面会要求输入 `token ` 值，根据[账号资料](http://starthope.tpddns.cn:8443/!/#iMannings/view/head/iMannings_document/%E5%95%86%E5%8A%A1%E6%96%87%E6%A1%A3/%E8%B4%A6%E5%8F%B7%E8%B5%84%E6%96%99.txt)的第四点，前往对应网页并登录，从中获取 `login` 请求的响应字段 `token` 。

#### 前端项目的拉取/修改权限

需要开启 [VPN](https://124.90.46.14:4431)

#### 开启代码检测

该项目需要开启 eslint 模式，从 HbuilderX 的插件市场搜索 `eslint`，将搜索到的两个插件下载，并配置为实时开启。需要注意每个对象的最后一个属性都要添加 `,`

#### 代码规范

对应阿里前端[开发规范](https://w3ctim.com/post/1d821dd8.html)，同时要注意git的[提交规范](http://starthope.tpddns.cn:8443/!/#iMannings/view/head/iMannings_document/%E8%AE%BE%E8%AE%A1%E6%96%87%E6%A1%A3/git%E6%8F%90%E4%BA%A4%E8%A6%81%E6%B1%82.txt)。

#### 接口文档

[跳转](https://mannings-dev.miyatech.com/api/order/swagger-ui.html#/%E4%B8%87%E5%AE%81B%E7%AB%AF%E8%AE%A2%E5%8D%95%E6%8E%A5%E5%8F%A3)。

#### 高保真

[飞书](https://f0ldzgf7pd.feishu.cn/drive/home/)、

#### 微信 AppId

wxc836213220ab21fb



#### 本地调联

```react
/* 将工程名替换为小伙伴的本地服务器 */
url: 'user/auth/member/get-logout-information',

url: 'http://192.168.0.209:8086/auth/member/get-logout-information',
```

| --       | --   |
| -------- | ---- |
| haosong  | 214  |
| shanhuan | 209  |



## 开发规范

### 页面结构

```react
- 万宁
  + src
    - pages
      + order                     // 相关主题的页面
        - list                    // 具体的页面
          + components            // 子组件
            - Edit.vue
            - List.vue
            - Search.vue
          + model
            - index.js            // 存放某些下拉框等的枚举值，使用时通过底部的方法转化为需要的格式
          + vuex
            - common.js           // 定义页面需要的全部接口，定义涉及到修改状态、接口调用的方法
            - mutations.js        // 存放了两个最常用的同步方法：设置/更新，供 common.js 使用
            - store.js            // 定义了需要用到的 state
          + index.vue             // 页面组件（父组件），由子组件组成，耦合度低
```

> 所有从接口拿到的 需要用到的 数据，都直接保存在状态中。



### 页面接口

```react
- 万宁
  + src
    - api
      + order
        - list
          + index.js
```

跳转[接口文档](https://mannings-dev.miyatech.com/api/order/swagger-ui.html#/万宁B端订单接口/pageUsingGET)，具体接口的响应，点击 Model，然后点开内部的结构，可能会有中文注释



### 状态



#### 页面状态 & 同步方法注册到全局状态管理

```
- 万宁
  + src
    - store
      + index.js
```

```javascript
import orderListState from '@/pages/order/list/vuex/store';
import orderListMutations from '@/pages/order/list/vuex/mutations';

const state = {
  orderListState,
};

const mutations = {
  ...orderListMutations,
};
```



#### 同步方法的定义

`mutation.js`

```javascript
export default {
  UPDATE_ORDER_LIST_STATE: (state, payload) => {
    state.orderListState[payload.key] = payload.value;
  },
  SET_ORDER_LIST_DATA: (state, payload) => {
    state.orderListState.listData[payload.key] = payload.value;
  },
};
```

`common.js`

```javascript
export default {
  methods: {
    /* 相当于设置状态 show 的值 */  
    setShow(value) {
      this.$store.commit('UPDATE_ORDER_LIST_STATE', {
        key: 'show',
        value,
      });
    },
  }
}
```

:star2: `mutation.js` 中的同步方法会另行注册到全局状态管理中。



#### 状态的使用

```javascript
import { mapState } from 'vuex';

export default {
  computed: {
    ...mapState(['orderListState']),
    /* 有的状态会抽出来再使用 */  
    isEdit() {
      return this.orderListState.isEdit;
    },  
  }
  methods: {
    /* 有的状态则不会 */
    demo() {
      console.log(this.orderListState.isDemo);
    }
  }
}
```

直接取到的 `orderListState` 相当于在全局状态管理中导入的，对应着 `当前页面文件夹 - vuex - store.js` 的整个模块，使用具体的状态还要再下一层。



#### 状态方法的使用

```javascript
import commonVuex from './vuex/common';
export default {
  mixins: [commonVuex],
}
```

直接在组件中通过 `this.xx()` 可以调用该文件中的方法



### 跳转到新页面/组件

|      操作位置      | 步骤                         | 补充                 |
| :----------------: | :--------------------------- | -------------------- |
| 调用 vuex 中的方法 | 发起请求，将结果保存到状态中 | 请求前后设置加载图标 |
| 调用 vuex 中的方法 | 更改状态的值                 | 该值条件渲染目标组件 |
|   跳转的目标组件   | 将状态的值保存到本地，渲染   | watch、created       |





## 帮助

### Ant 表格的部分配置

```react
<span slot="postSaleState" slot-scope="text, record, index">  // 单元格数据、行数据、行索引
  {{ getValue(model.postSaleState, text) }}
</span>

/* 表头配置的其中两项 */
{
  title: '售后状态',
  dataIndex: 'postSaleState',
  key: 'postSaleState',
  scopedSlots: { customRender: 'postSaleState' },  // 自定义该列数据
  fixed: 'left',       // 表示列固定在左侧，该属性用于表格最左/右侧的一到多项
},
{
  title: '创建时间',         // 列标题
  dataIndex: 'createTime',  // 列数据在数据项中对应的键
  key: 'createTime',        // vue所需的key
  width: 300,              // 列宽度
}
```



### 使用枚举（映射）

> 如果接口的某项请求参数后有跟映射关系，意味着要使用映射的值。
>
> 感觉可以直接使用为 [枚举 & 下拉框数据源](#枚举 & 下拉框数据源) 的方式，更简便。

```react
<span>售后状态：{{ getValue(model.postSaleState,info.postSaleState) }}</span>

import ModelState from '../model/index';
data() {
  model: {
    postSaleState: ModelState.POST_SALE_STATE,
    businessType: ModelState.BUSINESS_TYPE,
  },
},
/* 这个方法感觉也能抽到 ModelState 中 */
methods: {
  getValue(object, key) {
    const option = '';
    if (object[key] !== undefined) {
      const { label } = object[key];
      return label;
    }
    return option;
  },
},

/* info 为请求到的数据，但其中的几个属性需要显示为其映射 */
```

按它的规矩，请求到的数据都先保存到 vuex 中，这里的 `info` 是赋值为对应状态的本地变量。

它规矩中的这两步显得很累赘。

`index.js`

```javascript
const POST_SALE_STATE = {
  PENDING: {
    value: 'PENDING',
    label: '待处理',
  },
  PROCESSING: {
    value: 'PROCESSING',
    label: '处理中',
  },
};
const BUSINESS_TYPE = {
  CITY: {
    value: 'CITY',
    label: '闪送',
  },
  DELIVERY: {
    value: 'DELIVERY',
    label: '快递',
  },
};
```



### 枚举 & 下拉框数据源

```react
options: SaleState.getOptions(SaleState.POST_SALE_STATE)

import SaleState from '../model/index';
```



## 解决问题

#### 解决严格模式下换行报错

使用的是 HbuilderX 编辑器。

工具 - 设置 - 常用配置

```
制表符长度：2

空格代替制表符： 勾选
```



#### eslint部分总结

```react
/* if 后跟空格 */
if () {};

/* 注释前后单空格 */

/* 代码后不允许空格 */

/* 对象的最后属性接, */
{
  a: 1,
  b: 2,
}
  
/* 包括函数参数，声明的属性必须使用 */
  
/* js文件最后需要有空行 */
  
/* 简单箭头函数（直接返回值）要写为一行 */
```



#### 组件的watch不生效

由于组件与兄弟组件中使用 `v-if` 和 `v-else` 进行条件渲染，导致未能监听到值的变化。推测可以用 watch 的配置来解决这个问题。



#### 刷新页面后数据丢失

#### 返回页面后数据保留

在 `created` 中将状态保存为页面数据/设置状态的初始值。

推测也可以通过配置监听解决刷新页面的问题。



#### 报错：计算属性没有设置方法

> 组件中v-model=“XXX”，而XXX是vuex state中的某个变量，html中 isAllChecked 是由v-model ，vuex中是单项流，v-model是vue中的双向绑定，但是在computed中只通过get获取参数值 没有set无法改变参数值

`报错`

```
Computed property “isAllChecked” was assigned to but it has no setter.
```

`解决`

A. 不使用计算属性，直接将状态值用于弹出框的可见绑定

B. 见[详情](https://blog.csdn.net/qq_34250472/article/details/112765285)



202022011021140722065813



```
git commit --no-verify -m "提交的注释"
```


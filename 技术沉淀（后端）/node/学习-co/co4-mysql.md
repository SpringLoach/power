## å¸¸è§çš„æ•°æ®åº“

<span style="color: #f7534f;font-weight:600">å…³ç³»å‹æ•°æ®åº“</span> MySQLã€Oracleã€SQL Server

- å…³ç³»å‹æ•°æ®åº“é€šå¸¸æˆ‘ä»¬ä¼šåˆ›å»ºå¾ˆå¤šä¸ªäºŒç»´æ•°æ®è¡¨ï¼› 

- æ•°æ®è¡¨ä¹‹é—´ç›¸äº’å…³è”èµ·æ¥ï¼Œå½¢æˆä¸€å¯¹ä¸€ã€ä¸€å¯¹å¤šã€å¤šå¯¹å¯¹ç­‰å…³ç³»ï¼› 

- ä¹‹åå¯ä»¥åˆ©ç”¨SQLè¯­å¥åœ¨å¤šå¼ è¡¨ä¸­æŸ¥è¯¢æˆ‘ä»¬æ‰€éœ€çš„æ•°æ®ï¼› 

- æ”¯æŒäº‹åŠ¡ï¼Œå¯¹æ•°æ®çš„è®¿é—®æ›´åŠ çš„å®‰å…¨ã€‚

<span style="color: #f7534f;font-weight:600">éå…³ç³»å‹æ•°æ®åº“</span> MongoDB

- ç›¸å¯¹æ¥è¯´ç®€å•ï¼Œå­˜å‚¨æ•°æ®ä¹Ÿä¼šæ›´åŠ è‡ªç”±ï¼ˆå¯ä»¥ç›´æ¥å°†å¤æ‚çš„jsonå¯¹è±¡ç›´æ¥å¡å…¥åˆ°æ•°æ®åº“ä¸­ï¼‰ï¼›

- åŸºäºKey-Valueçš„å¯¹åº”å…³ç³»ï¼Œå¹¶ä¸”æŸ¥è¯¢çš„è¿‡ç¨‹ä¸­ä¸éœ€è¦ç»è¿‡SQLè§£æï¼Œæ‰€ä»¥æ€§èƒ½æ›´é«˜ï¼›

- é€šå¸¸ä¸æ”¯æŒäº‹åŠ¡ï¼Œéœ€è¦åœ¨è‡ªå·±çš„ç¨‹åºä¸­æ¥ä¿è¯ä¸€äº›åŸå­æ€§çš„æ“ä½œã€‚



### è®¤è¯†MySQL

å¯ä»¥å°† MySQL çœ‹ä½œä¸€ä¸ªè½¯ä»¶ï¼ˆç¨‹åºï¼‰ï¼Œç”¨äºç®¡ç†å¤šä¸ªæ•°æ®åº“ã€‚æ¯ä¸ªæ•°æ®åº“ä¸­å¯ä»¥æœ‰å¤šå¼ è¡¨ï¼Œæ¯ä¸ªè¡¨å¯ä»¥æœ‰å¤šæ¡æ•°æ®ã€‚

![image-20220701105701182](.\img\MySQL)



### å®‰è£…MySQL

æ‰“å¼€[å®˜ç½‘](https://www.mysql.com/)

![image-20220701140218376](.\img\mysql1)



![image-20220701142224741](D:\ç¬”è®°\æŠ€æœ¯æ²‰æ·€ï¼ˆåç«¯ï¼‰\node\img\mysql2)



![image-20220701142259908](D:\ç¬”è®°\æŠ€æœ¯æ²‰æ·€ï¼ˆåç«¯ï¼‰\node\img\mysql3)



![image-20220701140454768](D:\ç¬”è®°\æŠ€æœ¯æ²‰æ·€ï¼ˆåç«¯ï¼‰\node\img\mysql4)



![image-20220701142957635](D:\ç¬”è®°\æŠ€æœ¯æ²‰æ·€ï¼ˆåç«¯ï¼‰\node\img\mysql5)



![image-20220701143113039](D:\ç¬”è®°\æŠ€æœ¯æ²‰æ·€ï¼ˆåç«¯ï¼‰\node\img\mysql6)



![image-20220701143155127](D:\ç¬”è®°\æŠ€æœ¯æ²‰æ·€ï¼ˆåç«¯ï¼‰\node\img\mysql7)

![image-20220701143212681](D:\ç¬”è®°\æŠ€æœ¯æ²‰æ·€ï¼ˆåç«¯ï¼‰\node\img\mysql8)

![image-20220701143449451](D:\ç¬”è®°\æŠ€æœ¯æ²‰æ·€ï¼ˆåç«¯ï¼‰\node\img\mysql9)

![image-20220701143607776](D:\ç¬”è®°\æŠ€æœ¯æ²‰æ·€ï¼ˆåç«¯ï¼‰\node\img\mysql10)

![image-20220701143726908](D:\ç¬”è®°\æŠ€æœ¯æ²‰æ·€ï¼ˆåç«¯ï¼‰\node\img\mysql11)

![image-20220701143756492](D:\ç¬”è®°\æŠ€æœ¯æ²‰æ·€ï¼ˆåç«¯ï¼‰\node\img\mysql12)

![image-20220701144000281](C:\Users\86186\AppData\Roaming\Typora\typora-user-images\image-20220701144000281.png)

ç­‰å¾…å®Œæˆåç‚¹å‡»ä¸‹ä¸€æ­¥

![image-20220701144040184](D:\ç¬”è®°\æŠ€æœ¯æ²‰æ·€ï¼ˆåç«¯ï¼‰\node\img\mysql13)

æ­¥éª¤å®Œæˆåï¼Œå¯ä»¥åœ¨èœå•æœç´¢æœåŠ¡ï¼Œæ‰¾åˆ°å¯¹åº”çš„ç¨‹åºï¼Œç¡®è®¤æ˜¯å¦å¼€å¯äº†æœåŠ¡ã€‚

![image-20220701144244625](D:\ç¬”è®°\æŠ€æœ¯æ²‰æ·€ï¼ˆåç«¯ï¼‰\node\img\mysql14)



### è¿æ¥MySQL

#### é…ç½®ç¯å¢ƒå˜é‡

> å°†å®‰è£…ç›®å½•ä¸‹çš„ `bin` æ–‡ä»¶å¤¹æ·»åŠ åˆ°ç¯å¢ƒå˜é‡ï¼Œé»˜è®¤çš„å®‰è£…è·¯å¾„å¦‚ä¸‹ã€‚

![image-20220701153559821](D:\ç¬”è®°\æŠ€æœ¯æ²‰æ·€ï¼ˆåç«¯ï¼‰\node\img\è¿æ¥mysql)

**éªŒè¯**

```elm
mysql --version	
```



#### éƒ¨åˆ†å‘½ä»¤

| æ“ä½œ                   | å‘½ä»¤                  | è¯´æ˜             |
| ---------------------- | --------------------- | ---------------- |
| ç™»å½•ç¨‹åº               | mysql -uroot -pmima   | mimaï¼šå®é™…å¯†ç    |
| æŸ¥çœ‹æ‰€æœ‰æ•°æ®åº“         | show databases;       |                  |
| åˆ›å»ºæ•°æ®åº“             | create database name; | nameï¼šæ•°æ®åº“åç§° |
| æŸ¥çœ‹æ‰€åœ¨æ•°æ®åº“         | select database();    |                  |
| åˆ‡æ¢åˆ°æŸä¸ªæ•°æ®åº“       | use name;             | nameï¼šæ•°æ®åº“åç§° |
| æŸ¥çœ‹æ•°æ®åº“çš„æ‰€æœ‰è¡¨     | show tables;          |                  |
| åˆ›å»ºè¡¨å¹¶æŒ‡å®šè¡¨çš„å­—æ®µ   |                       |                  |
| æŸ¥çœ‹æŸä¸ªè¡¨ä¸­çš„æ‰€æœ‰æ•°æ® | select * from name;   | nameï¼šè¡¨å       |
| å¾€è¡¨ä¸­åŠ æ•°æ®           |                       |                  |

:whale: è¿™é‡Œä¸ºäº†å®¹æ˜“è¯»æ‡‚ï¼Œæš‚æ—¶éƒ½ç”¨å°å†™ï¼ˆä¹Ÿæœ‰æ•ˆï¼‰ã€‚



**åœ¨å½“å‰æ•°æ®åº“ä¸­åˆ›å»ºè¡¨å¹¶æŒ‡å®šè¡¨çš„å­—æ®µ**

```sql
create table table_name(
  -> nick varchar(10),
  -> age int,
  -> height double);
```

:trident: table_name ä¸ºè¡¨åï¼›

:turtle: ç”¨åˆ†å·ç»“å°¾ï¼Œå¹¶æ•²ä¸‹å›è½¦ï¼Œè¡¨ç¤ºè¯­å¥ç»“æŸã€‚



**å¾€è¡¨ä¸­åŠ æ•°æ®**

```sql
insert into table_name  (nick, age, height) values ('demo', 18, 1.88);
```

:turtle: ç¬¬ä¸€ä¸ªæ‹¬å·ä¸­çš„å†…å®¹è¡¨ç¤ºç»™è¡¨çš„å“ªäº›å±æ€§èµ‹å€¼ã€‚



#### é»˜è®¤çš„æ•°æ®åº“

<span style="color: #f7534f;font-weight:600"> infomation_schema</span> ä¿¡æ¯æ•°æ®åº“ï¼Œå…¶ä¸­åŒ…æ‹¬MySQLåœ¨ç»´æŠ¤çš„å…¶ä»–æ•°æ®åº“ã€è¡¨ã€ åˆ—ã€è®¿é—®æƒé™ç­‰ä¿¡æ¯ï¼› 

<span style="color: #f7534f;font-weight:600">performance_schema</span> æ€§èƒ½æ•°æ®åº“ï¼Œè®°å½•ç€ç¨‹åºè¿è¡Œä¸­çš„ä¸€äº›<span style="color: #ff0000">èµ„æºæ¶ˆè€—</span>ç›¸å…³çš„ä¿¡æ¯ï¼› 

<span style="color: #f7534f;font-weight:600">mysql</span> ç”¨äºå­˜å‚¨æ•°æ®åº“ç®¡ç†è€…çš„ç”¨æˆ·ä¿¡æ¯ã€æƒé™ä¿¡æ¯ä»¥åŠä¸€äº›æ—¥å¿—ä¿¡æ¯ç­‰ï¼› 

<span style="color: #f7534f;font-weight:600">sys</span> ç®€æ˜“ç‰ˆçš„ <span style="color: #ed5a65">performance_schema</span>ï¼Œå°†æ€§èƒ½æ•°æ®åº“ä¸­çš„æ•°æ®æ±‡æ€»æˆæ›´å®¹æ˜“ç†è§£çš„å½¢å¼ã€‚



### ä½¿ç”¨Navicat

> ä¸€ä¸ªå›¾å½¢åŒ–æ“ä½œæ•°æ®åº“çš„å·¥å…·ï¼Œæ”¶è´¹å¾ˆè´µï¼Œå¯ä»¥èµ°[æ·å¾„](https://www.bilibili.com/read/cv15128680)ä¸‹è½½ã€‚

![image-20220701171106455](D:\ç¬”è®°\æŠ€æœ¯æ²‰æ·€ï¼ˆåç«¯ï¼‰\node\img\Navicat)





![image-20220701171202675](D:\ç¬”è®°\æŠ€æœ¯æ²‰æ·€ï¼ˆåç«¯ï¼‰\node\img\Navicatæ‰“å¼€é“¾æ¥)

#### æ‰‹åŠ¨ç¼–è¾‘æ•°æ®

![image-20220701171301745](D:\ç¬”è®°\æŠ€æœ¯æ²‰æ·€ï¼ˆåç«¯ï¼‰\node\img\Navicatä¿®æ”¹æ•°æ®)

#### ç¼–å†™SQLè¯­å¥

![image-20220701171417545](D:\ç¬”è®°\æŠ€æœ¯æ²‰æ·€ï¼ˆåç«¯ï¼‰\node\img\Navicatå†™SQL1)



![image-20220701171434586](D:\ç¬”è®°\æŠ€æœ¯æ²‰æ·€ï¼ˆåç«¯ï¼‰\node\img\Navicatå†™SQL2)





#### ä¿å­˜æŸ¥è¯¢ç»“æœ

![image-20220701175027311](D:\ç¬”è®°\æŠ€æœ¯æ²‰æ·€ï¼ˆåç«¯ï¼‰\node\img\Navicatä¿å­˜sql)

:whale: ä¹Ÿå¯ä»¥æ‰“å¼€å¤–éƒ¨æŸ¥è¯¢ï¼Œä½¿ç”¨å…¶å®ƒæ–‡ä»¶ä¸­çš„è¯­å¥ã€‚



#### ä¿®æ”¹å­—ç¬¦é›†

![image-20220701175406654](D:\ç¬”è®°\æŠ€æœ¯æ²‰æ·€ï¼ˆåç«¯ï¼‰\node\img\Navicatå­—ç¬¦é›†)

:turtle: utf8mb4 å¯ä»¥æ”¯æŒ emoji è¡¨æƒ…ï¼Œè¿™æ˜¯ utf8 åšä¸åˆ°çš„ã€‚



#### åˆ·æ–°è·å–æ‰§è¡Œç»“æœ

æ‰§è¡Œ SQL è¯­å¥åï¼Œå¯èƒ½ä¼šå‡ºç°æ²¡æ›´æ–°çš„æƒ…å†µï¼Œå¯ä»¥åœ¨å·¦ä¾§åˆ—è¡¨æ‰‹åŠ¨åˆ·æ–°ã€‚



#### ç¼–è¾‘è¡¨ç»“æ„

é€‰ä¸­è¡¨ï¼Œå³é”® -> è®¾è®¡è¡¨ã€‚

:turtle: åœ¨é”®åˆ—å‡ºç°ğŸ”‘çš„ä¸ºä¸»é”®ã€‚



## MYSQLè¯­å¥

#### æ“ä½œæ•°æ®åº“

```sql
# æŸ¥çœ‹æ‰€æœ‰çš„æ•°æ®åº“
SHOW DATABASES;

# é€‰æ‹©æŸä¸€ä¸ªæ•°æ®åº“
USE bili;

### åˆ›å»ºæ–°çš„æ•°æ®åº“
# åˆ›å»ºæ•°æ®åº“ï¼ˆä¸å¤Ÿä¸¥è°¨ï¼Œå¯èƒ½åœ¨æ‰§è¡Œæ—¶æŠ¥é”™ï¼‰
CREATE DATABASE douyu;
# åˆ›å»ºæ•°æ®åº“ï¼ˆå¸¸è§„ï¼‰
CREATE DATABASE IF NOT EXISTS douyu;
# åˆ›å»ºæ•°æ®åº“ï¼ˆå¹¶è®¾ç½®å­—ç¬¦é›†å’Œæ’åºæ–¹å¼ï¼‰
CREATE DATABASE IF NOT EXISTS huya DEFAULT CHARACTER SET utf8mb4
 				COLLATE utf8mb4_0900_ai_ci;

# åˆ é™¤æ•°æ®åº“
DROP DATABASE IF EXISTS douyu;

# æŸ¥çœ‹å½“å‰æ­£åœ¨ä½¿ç”¨çš„æ•°æ®åº“
SELECT DATABASE();

# ä¿®æ”¹æ•°æ®åº“çš„ç¼–ç 
ALTER DATABASE huya CHARACTER SET = utf8 
				COLLATE = utf8_unicode_ci;
```



#### æ“ä½œæ•°æ®è¡¨

```sql
# æŸ¥çœ‹æ‰€æœ‰çš„è¡¨
SHOW TABLES;

# æ–°å»ºè¡¨
CREATE TABLE IF NOT EXISTS `students` (
	`name` VARCHAR(10) NOT NULL,
	`age` int,
	`score` int,
	`height` DECIMAL(10,2),
	`birthday` YEAR,
	`phoneNum` VARCHAR(20) UNIQUE
);
# å®Œæ•´çš„åˆ›å»ºè¡¨çš„è¯­æ³•ï¼ˆè¿™é‡Œç”¨idä½œä¸ºä¸»é”®ä¸”è‡ªå¢ï¼‰
CREATE TABLE IF NOT EXISTS `users`(
	id INT PRIMARY KEY AUTO_INCREMENT,
	name VARCHAR(20) NOT NULL,
	age INT DEFAULT 0,
	phoneNum VARCHAR(20) UNIQUE DEFAULT '',
	createTime TIMESTAMP
);

# åˆ é™¤è¡¨
DROP TABLE IF EXISTS `moment`;

# æŸ¥çœ‹è¡¨çš„ç»“æ„
DESC students;
# æŸ¥çœ‹åˆ›å»ºè¡¨ç”¨åˆ°çš„SQLè¯­å¥
SHOW CREATE TABLE `students`;


# ä¿®æ”¹è¡¨
# 1.ä¿®æ”¹è¡¨çš„åå­—
ALTER TABLE `users` RENAME TO `user`;
# 2.æ·»åŠ ä¸€ä¸ªå­—æ®µ
ALTER TABLE `user` ADD `updateTime` TIMESTAMP;
# 3.ä¿®æ”¹å­—æ®µçš„åç§°
ALTER TABLE `user` CHANGE `phoneNum` `telPhone` VARCHAR(20);
# 4.ä¿®æ”¹å­—æ®µçš„ç±»å‹
ALTER TABLE `user` MODIFY `name` VARCHAR(30);
# 5.åˆ é™¤æŸä¸€ä¸ªå­—æ®µ
ALTER TABLE `user` DROP `age`;

# è¡¥å……
# æ ¹æ®ä¸€ä¸ªè¡¨ç»“æ„å»åˆ›å»ºå¦å¤–ä¸€å¼ è¡¨ï¼ˆåŒ…å«ä¸»é”®ç­‰ï¼‰
CREATE TABLE `user2` LIKE `user`;
# æ ¹æ®å¦å¤–ä¸€ä¸ªè¡¨ä¸­çš„æ‰€æœ‰å†…å®¹ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„è¡¨ï¼ˆä¸åŒ…å«ä¸»é”®ï¼‰
CREATE TABLE `user3` (SELECT * FROM `user`); 
```

:ghost: å¦‚æœé‡åˆ°<span style="color: #ff0000">å…³é”®å­—</span>ä½œä¸ºè¡¨åæˆ–è€…å­—æ®µåç§°ï¼Œå¯ä»¥ä½¿ç”¨ `` åŒ…è£¹è¯¥åç§°ã€‚



#### è®°å½•-å¢åˆ æ”¹

```sql
# æ’å…¥æ•°æ®ï¼ˆä¸æŒ‡å®šå­—æ®µæ·»åŠ ï¼‰
INSERT INTO `user` VALUES (110, 'why', '020-110110', '2020-10-20', '2020-11-11');

# æ’å…¥æ•°æ®ï¼ˆæŒ‡å®šå­—æ®µæ·»åŠ ï¼‰
INSERT INTO `user` (name, telPhone, createTime, updateTime)
						VALUES ('kobe', '000-1111111', '2020-10-10', '2030-10-20');
						
# æ’å…¥æ•°æ®ï¼ˆå­˜åœ¨é»˜è®¤å€¼çš„å­—æ®µå¯ä»¥ä¸è®¾ç½®ï¼‰
INSERT INTO `user` (name, telPhone)
						VALUES ('lilei', '000-1111112');

# éœ€æ±‚ï¼šcreateTimeå’ŒupdateTimeçš„é»˜è®¤å€¼ä¸ºå½“å‰æ—¶é—´ï¼Œä¸”åœ¨ä¿®æ”¹è®°å½•æ—¶æ›´æ–°updateTimeå­—æ®µ
ALTER TABLE `user` MODIFY `createTime` TIMESTAMP DEFAULT CURRENT_TIMESTAMP;
ALTER TABLE `user` MODIFY `updateTime` TIMESTAMP DEFAULT CURRENT_TIMESTAMP                                                              ON UPDATE CURRENT_TIMESTAMP;

INSERT INTO `user` (name, telPhone)
						VALUES ('lucy', '000-1121212');


# åˆ é™¤æ•°æ®
# åˆ é™¤æ‰€æœ‰çš„è®°å½•
DELETE FROM `user`;
# åˆ é™¤ç¬¦åˆæ¡ä»¶çš„è®°å½•
DELETE FROM `user` WHERE id = 110;

# æ›´æ–°æ•°æ®
# æ›´æ–°æ‰€æœ‰çš„è®°å½•
UPDATE `user` SET name = 'lily', telPhone = '010-110110';
# æ›´æ–°ç¬¦åˆæ¡ä»¶çš„è®°å½•
UPDATE `user` SET name = 'lily', telPhone = '010-110110' WHERE id = 115;
```



#### è®°å½•-æŸ¥

```sql
# åˆ›å»ºproductsçš„è¡¨
CREATE TABLE IF NOT EXISTS `products` (
	id INT PRIMARY KEY AUTO_INCREMENT,
	brand VARCHAR(20),
	title VARCHAR(100) NOT NULL,
	price DOUBLE NOT NULL,
	score DECIMAL(2,1),
	voteCnt INT,
	url VARCHAR(100),
	pid INT
);

# 1.åŸºæœ¬æŸ¥è¯¢
# æŸ¥è¯¢è¡¨ä¸­æ‰€æœ‰çš„å­—æ®µä»¥åŠæ‰€æœ‰çš„æ•°æ®
SELECT * FROM `products`;
# æŸ¥è¯¢æŒ‡å®šçš„å­—æ®µ
SELECT title, price FROM `products`;
# å¯¹å­—æ®µç»“æœèµ·åˆ«å
SELECT title as phoneTitle, price as currentPrice FROM `products`;


# 2.whereæ¡ä»¶
# 2.1. æ¡ä»¶åˆ¤æ–­è¯­å¥
# æ¡ˆä¾‹ï¼šæŸ¥è¯¢ä»·æ ¼å°äº1000çš„æ‰‹æœº
SELECT title, price FROM `products` WHERE price < 1000;
# æ¡ˆä¾‹äºŒï¼šä»·æ ¼ç­‰äº999çš„æ‰‹æœº
SELECT * FROM `products` WHERE price = 999;
# æ¡ˆä¾‹ä¸‰ï¼šä»·æ ¼ä¸ç­‰äº999çš„æ‰‹æœº
SELECT * FROM `products` WHERE price != 999;
SELECT * FROM `products` WHERE price <> 999;

# 2.2. é€»è¾‘è¿ç®—è¯­å¥
# æ¡ˆä¾‹ä¸€ï¼šæŸ¥è¯¢1000åˆ°2000ä¹‹é—´çš„æ‰‹æœº
SELECT * FROM `products` WHERE price > 1000 AND price < 2000;
SELECT * FROM `products` WHERE price > 1000 && price < 2000;
# BETWEEN AND åŒ…å«ç­‰äº
SELECT * FROM `products` WHERE price BETWEEN 1099 AND 2000;

# æ¡ˆä¾‹äºŒï¼šä»·æ ¼åœ¨5000ä»¥ä¸Šæˆ–è€…æ˜¯å“ç‰Œæ˜¯åä¸ºçš„æ‰‹æœº
SELECT * FROM `products` WHERE price > 5000 || brand = 'åä¸º';

# æŸ¥è¯¢å­—æ®µä¸ºNULL
SELECT * FROM `products` WHERE url IS NULL;
# æŸ¥è¯¢å­—æ®µä¸ä¸ºNULL
SELECT * FROM `products` WHERE url IS NOT NULL;

# 2.3.æ¨¡ç³ŠæŸ¥è¯¢
# åŒ…å«M
SELECT * FROM `products` WHERE title LIKE '%M%';
# ç¬¬äºŒä¸ªå­—ç¬¦ä¸ºM
SELECT * FROM `products` WHERE title LIKE '_M%';


# 3.å­—æ®µç¬¦åˆå¤šä¸ªæ¡ä»¶ä¹‹ä¸€
SELECT * FROM `products` WHERE brand = 'åä¸º' || brand = 'å°ç±³' || brand = 'è‹¹æœ';
SELECT * FROM `products` WHERE brand IN ('åä¸º', 'å°ç±³', 'è‹¹æœ') 

# 4.å¯¹ç»“æœè¿›è¡Œæ’åº
# æŒ‰ä»·æ ¼å‡åºï¼Œç›¸åŒä»·æ ¼çš„è®°å½•æŒ‰è¯„åˆ†é™åº
SELECT * FROM `products` WHERE brand IN ('åä¸º', 'å°ç±³', 'è‹¹æœ') 
												 ORDER BY price ASC, score DESC;

# 5.åˆ†é¡µæŸ¥è¯¢
# LIMIT limit OFFSET offset;
SELECT * FROM `products` LIMIT 20 OFFSET 0;
SELECT * FROM `products` LIMIT 20 OFFSET 20;
# Limit offset, limit;
SELECT * FROM `products` LIMIT 40, 20;
```

:point_down: å¯ä»¥é€šè¿‡ä¸‹é¢ä¸€èŠ‚çš„æ–¹å¼æ¥å°†å‡†å¤‡å¥½çš„æ•°æ®åµŒå…¥åˆ°è¡¨æ ¼ä¸­ã€‚



#### è¾…åŠ©-æ·»åŠ è®°å½•

å¼•å…¥å‡†å¤‡å¥½çš„ `json` æ–‡ä»¶åï¼Œç”¨ node æ‰§è¡Œä¸‹é¢ä»£ç å³å¯å‘å¯¹åº”è¡¨æ’å…¥æ•°æ®ã€‚

```elm
npm install mysql2
```

```javascript
const mysql = require('mysql2');
 
const connection = mysql.createConnection({
  host: 'localhost',
  port: 3306,
  user: 'root',
  password: 'xxxx',
  database: 'xxxx'
});

const statement = `INSERT INTO products SET ?;`
const phoneJson = require('./phone.json');

for (let phone of phoneJson) {
  connection.query(statement, phone);
}
```



#### èšåˆå‡½æ•°

```sql
# 1.èšåˆå‡½æ•°çš„ä½¿ç”¨
# æ±‚æ‰€æœ‰æ‰‹æœºçš„ä»·æ ¼çš„æ€»å’Œ
SELECT SUM(price) FROM `products`;
# æ±‚æ‰€æœ‰æ‰‹æœºçš„ä»·æ ¼çš„æ€»å’Œï¼Œè¾“å‡ºåˆ«å
SELECT SUM(price) AS totalPrice FROM `products`;
SELECT SUM(price) totalPrice FROM `products`;
# æ±‚ä¸€ä¸‹åä¸ºæ‰‹æœºçš„ä»·æ ¼çš„æ€»å’Œ
SELECT SUM(price) FROM `products` WHERE brand = 'åä¸º';
# æ±‚åä¸ºæ‰‹æœºçš„å¹³å‡ä»·æ ¼
SELECT AVG(price) FROM `products` WHERE brand = 'åä¸º';
# æœ€é«˜æ‰‹æœºçš„ä»·æ ¼å’Œæœ€ä½æ‰‹æœºçš„ä»·æ ¼
SELECT MAX(price) FROM `products`;
SELECT MIN(price) FROM `products`;

# æ±‚è‹¹æœæ‰‹æœºçš„è®°å½•æ¡æ•°
SELECT COUNT(*) FROM `products` WHERE brand = 'è‹¹æœ';
# æ±‚urlå­—æ®µä¸ä¸ºNULLçš„ï¼Œè‹¹æœæ‰‹æœºçš„è®°å½•æ¡æ•°
SELECT COUNT(url) FROM `products` WHERE brand = 'è‹¹æœ';

# æ±‚ä»·æ ¼å»é‡åçš„è®°å½•æ¡æ•°
SELECT COUNT(DISTINCT price) FROM `products`;
```

#### èšåˆå‡½æ•°-åˆ†ç»„

```sql
# 2.GROUP BYçš„ä½¿ç”¨
# æŒ‰ç…§å“ç‰Œåˆ†ç»„ï¼Œè·å–å“ç‰Œåã€å¹³å‡ä»·æ ¼ã€æ¡æ•°ã€å¹³å‡åˆ†æ•°
SELECT brand, AVG(price), COUNT(*), AVG(score) FROM `products` GROUP BY brand;

# 3.HAVINGçš„ä½¿ç”¨
# æŒ‰ç…§å“ç‰Œåˆ†ç»„ï¼Œè·å–å“ç‰Œåã€å¹³å‡ä»·æ ¼ã€æ¡æ•°ã€å¹³å‡åˆ†æ•°ï¼Œå¹¶ä¸”åªè¦å¹³å‡ä»·æ ¼åœ¨2000ä»¥ä¸Šçš„
SELECT brand, AVG(price) avgPrice, COUNT(*), AVG(score) FROM `products` GROUP BY brand HAVING avgPrice > 2000;

# 4.åŒºåˆ«äºWHERE
# ç­›é€‰å¹³å‡åˆ†å¤§äº7.5çš„æ‰‹æœºï¼ŒæŒ‰ç…§å“ç‰Œåˆ†ç»„ï¼Œè·å–å“ç‰Œåã€å¹³å‡ä»·æ ¼
SELECT brand, AVG(price) FROM `products` WHERE score > 7.5 GROUP BY brand;
```

:ghost: æŸ¥è¯¢è¯­å¥åŠ ä¸Šåˆ†ç»„æ¡ä»¶åï¼Œå¯ä»¥æ‹¼æ¥åˆ†ç»„å­—æ®µï¼Œä½†å…¶å®ƒçš„å­—æ®µå¦‚æœå­˜åœ¨å¤šä¸ªä¸åŒçš„å€¼å°±ä¸èƒ½æ‹¼ä¸Šå»äº†ã€‚

:ghost: `WHERE` è¯­å¥åªèƒ½åº”ç”¨åœ¨ `GROUP BY` å‰é¢ï¼Œè¦æƒ³å¯¹åˆ†ç»„ç»“æœç»§ç»­ç­›é€‰ï¼Œè¦ç”¨ `HAVING` å­—æ®µï¼›

:question: `WHERE` è¯­å¥åä¼¼ä¹ä¸èƒ½è·Ÿèšåˆå‡½æ•°ï¼Œä¹Ÿä¸èƒ½è·Ÿå¯¹å…¶èµ·çš„åˆ«åã€‚



### å¤šè¡¨

#### å¤šè¡¨çš„è®¾è®¡å’Œçº¦æŸ

> å½“è¡¨ä¸­çš„æŸä¸ªå­—æ®µæœ‰è¾ƒå¤šçš„å…³è”ä¿¡æ¯æ—¶ï¼ˆå¦‚å“ç‰Œï¼Œå¯ä»¥æœ‰å“ç‰Œåç§°ï¼Œç½‘ç«™ï¼Œæ’åç­‰ç­‰ï¼‰ï¼Œå†å°†è¿™äº›ä¿¡æ¯æ·»åŠ åˆ°åŒä¸€ä¸ªè¡¨ä¸­ï¼Œä¼šå¯¼è‡´è¡¨è‡ƒè‚¿è€Œåˆå†—ä½™ï¼Œè¿™æ—¶å¯ä»¥æ–°å»ºä¸€ä¸ªè¡¨æ¥å­˜å‚¨ç›¸å…³çš„ä¿¡æ¯ã€‚

```sql
# 1.åˆ›å»ºbrandçš„è¡¨å’Œæ’å…¥æ•°æ®
CREATE TABLE IF NOT EXISTS `brand`(
	id INT PRIMARY KEY AUTO_INCREMENT,
	name VARCHAR(20) NOT NULL,
	website VARCHAR(100),
	phoneRank INT
);
# è‡ªè¡ŒåŠ ä¸€äº›æ•°æ®
INSERT INTO `brand` (name, website, phoneRank) VALUES ('åä¸º', 'www.huawei.com', 2);

# 2. ç»™è¡¨1æ·»åŠ å­—æ®µï¼Œå¼•ç”¨è¡¨brandä¸­çš„idä½œä¸ºå¤–é”®çº¦æŸ
# æ·»åŠ ä¸€ä¸ªbrand_idå­—æ®µ
ALTER TABLE `products` ADD `brand_id` INT;
# ä¿®æ”¹brand_idä¸ºå¤–é”®
ALTER TABLE `products` ADD FOREIGN KEY(brand_id) REFERENCES brand(id);

# è®¾ç½®brand_idçš„å€¼
UPDATE `products` SET `brand_id` = 1 WHERE `brand` = 'åä¸º';
```

:turtle: ä¹Ÿå¯ä»¥åœ¨å»ºè¡¨æ—¶ï¼Œå°±æŒ‡å®šå¤–é”®ã€‚

:ghost: å­—æ®µä¸€æ—¦è¢«å¤–é”®çº¦æŸï¼Œå®ƒçš„å€¼å°±åªèƒ½è®¾ç½®ä¸º NULL æˆ–å¦ä¸€è¡¨ä¸­å¤–é”®å·²å­˜åœ¨çš„å€¼ã€‚



#### ä¿®æ”¹å¤–é”®

```sql
# 1.é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœç›´æ¥ä¿®æ”¹å’Œåˆ é™¤å¤–é”®å¼•ç”¨çš„idï¼Œä¼šæŠ¥é”™
UPDATE `brand` SET `id` = 100 WHERE `id` = 1;


# 2.ä¿®æ”¹brand_idå…³è”å¤–é”®æ—¶çš„action
# 2.1.è·å–åˆ°ç›®å‰çš„å¤–é”®çš„åç§°
SHOW CREATE TABLE `products`;

-- CREATE TABLE `products` (
--   ...
--   `brand_id` int DEFAULT NULL,
--   PRIMARY KEY (`id`),
--   KEY `brand_id` (`brand_id`),
--   CONSTRAINT `products_ibfk_1` FOREIGN KEY (`brand_id`) REFERENCES `brand` (`id`)
-- ) ENGINE=InnoDB AUTO_INCREMENT=109 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci

# 2.2.æ ¹æ®åç§°å°†å¤–é”®åˆ é™¤æ‰
ALTER TABLE `products` DROP FOREIGN KEY products_ibfk_1;

# 2.2.é‡æ–°æ·»åŠ å¤–é”®çº¦æŸ
ALTER TABLE `products` ADD FOREIGN KEY (brand_id) REFERENCES brand(id)
							ON UPDATE CASCADE
							ON DELETE RESTRICT;

# 2.3.å†æ¬¡ä¿®æ”¹å¤–é”®å¼•ç”¨çš„idï¼ŒæˆåŠŸ~
UPDATE `brand` SET `id` = 100 WHERE `id` = 1;
```

| æ›´æ–°/åˆ é™¤å¤–é”®    | é…ç½®å€¼                                                       |
| ---------------- | ------------------------------------------------------------ |
| RESTRICTï¼ˆé»˜è®¤ï¼‰ | ä¼šæ£€æŸ¥è¯¥è®°å½•æ˜¯å¦æœ‰å…³è”çš„å¤–é”®è®°å½•ï¼Œæœ‰çš„è¯ä¸å…è®¸æ›´æ–°æˆ–åˆ é™¤     |
| NO ACTION        | åŒä¸Šï¼Œåœ¨SQLæ ‡å‡†ä¸­å®šä¹‰                                        |
| CASCADE          | ä¼šæ£€æŸ¥è¯¥è®°å½•æ˜¯å¦æœ‰å…³è”çš„å¤–é”®è®°å½•ï¼Œæ›´æ–°-æ›´æ–°è®°å½•ã€åˆ é™¤-åˆ é™¤å…³è”è®°å½• |
| SET NULL         | ä¼šæ£€æŸ¥è¯¥è®°å½•æ˜¯å¦æœ‰å…³è”çš„å¤–é”®è®°å½•ï¼Œå°†å¯¹åº”çš„å€¼è®¾ä¸º NULL        |

:octopus: åˆ é™¤æ—¶è®¾ç½®ä¸º CASCADEï¼Œä¼šå¯¼è‡´è®°å½•ä¹Ÿåˆ é™¤ï¼Œæ…ç”¨ã€‚





#### å¤šè¡¨æŸ¥è¯¢

```sql
# 1.è·å–åˆ°çš„æ˜¯ç¬›å¡å°”ä¹˜ç§¯(x*y)
SELECT * FROM `products`, `brand`;
# å°†ç»“æœè¿›è¡Œç­›é€‰
SELECT * FROM `products`, `brand` WHERE products.brand_id = brand.id;
```

:turtle: ç›¸å½“äºå°†è¡¨Açš„è®°å½•äºè¡¨Bçš„è®°å½•ä¸€ä¸€åˆå¹¶åï¼Œå†è¿›è¡Œç­›é€‰ï¼›

:turtle: å¼€å‘æ—¶ä¸ä¼šè¿™ä¹ˆæ“ä½œï¼Œæ€§èƒ½æ–¹é¢æ²¡é‚£ä¹ˆå¥½ã€‚å¯ä»¥ç”¨<span style="color: #a50">å†…è¿æ¥</span>æ›¿ä»£ï¼ŒæŸ¥è¯¢å‡ºæ¥çš„ç»“æœç›¸åŒã€‚

```sql
# 2.å·¦è¿æ¥
# 2.1. æŸ¥è¯¢æ‰€æœ‰çš„æ‰‹æœºï¼ˆåŒ…æ‹¬æ²¡æœ‰å“ç‰Œä¿¡æ¯çš„æ‰‹æœºï¼‰ä»¥åŠå¯¹åº”çš„å“ç‰Œ null
SELECT * FROM `products` LEFT JOIN `brand` ON products.brand_id = brand.id;
SELECT * FROM `products` LEFT OUTER JOIN `brand` ON products.brand_id = brand.id;

# 2.2. æŸ¥è¯¢æ²¡æœ‰å¯¹åº”å“ç‰Œæ•°æ®çš„æ‰‹æœº
SELECT * FROM `products` LEFT JOIN `brand` ON products.brand_id = brand.id WHERE brand.id IS NULL;


# 3.å³è¿æ¥
# 3.1. æŸ¥è¯¢æ‰€æœ‰çš„å“ç‰Œï¼ˆæ²¡æœ‰å¯¹åº”çš„æ‰‹æœºæ•°æ®ï¼Œå“ç‰Œä¹Ÿæ˜¾ç¤ºï¼‰ä»¥åŠå¯¹åº”çš„æ‰‹æœºæ•°æ®ï¼›
SELECT * FROM `products` RIGHT OUTER JOIN `brand` ON products.brand_id = brand.id;

# 3.2. æŸ¥è¯¢æ²¡æœ‰å¯¹åº”æ‰‹æœºçš„å“ç‰Œä¿¡æ¯
SELECT * FROM `products` RIGHT JOIN `brand` ON products.brand_id = brand.id WHERE products.brand_id IS NULL;


# 4.å†…è¿æ¥
SELECT * FROM `products` JOIN `brand` ON products.brand_id = brand.id;
# 4.1 å†…è¿æ¥åæ·»åŠ ç­›é€‰æ¡ä»¶
SELECT * FROM `products` JOIN `brand` ON products.brand_id = brand.id WHERE price = 8699;

# 5.å…¨è¿æ¥
# 5.1
(SELECT * FROM `products` LEFT OUTER JOIN `brand` ON products.brand_id = brand.id)
UNION
(SELECT * FROM `products` RIGHT OUTER JOIN `brand` ON products.brand_id = brand.id)

# 5.2
(SELECT * FROM `products` LEFT OUTER JOIN `brand` ON products.brand_id = brand.id WHERE brand.id IS NULL)
UNION
(SELECT * FROM `products` RIGHT OUTER JOIN `brand` ON products.brand_id = brand.id WHERE products.brand_id IS NULL)
```

:octopus: MySQL ä¸æ”¯æŒ `FULL OUTER JOIN` æ¥è¿›è¡Œå…¨è¿æ¥ï¼Œä½†å¯ä»¥ç”¨è”åˆæ¥å®ç°è¯¥æ•ˆæœã€‚

![image-20220702135925784](D:\ç¬”è®°\æŠ€æœ¯æ²‰æ·€ï¼ˆåç«¯ï¼‰\node\img\è¿æ¥)



#### å¤šå¯¹å¤šçš„å…³ç³»

> åœºæ™¯ï¼šå¦‚å­¦ç”Ÿé€‰è¯¾ï¼Œå­¦ç”Ÿå¯ä»¥é€‰æ‹©å¤šä¸ªè¯¾ç¨‹ï¼Œä¸€ä¸ªè¯¾ç¨‹åˆå¯èƒ½å¯¹åº”å¤šä¸ªå­¦ç”Ÿã€‚

å‡†å¤‡å­¦ç”Ÿè¡¨ï¼Œè¯¾ç¨‹è¡¨

```sql
# 1.åŸºæœ¬æ•°æ®çš„æ¨¡æ‹Ÿ
CREATE TABLE IF NOT EXISTS students(
	id INT PRIMARY KEY AUTO_INCREMENT,
	name VARCHAR(20) NOT NULL,
	age INT
);

CREATE TABLE IF NOT EXISTS courses(
	id INT PRIMARY KEY AUTO_INCREMENT,
	name VARCHAR(20) NOT NULL,
	price DOUBLE
);

INSERT INTO `students` (name, age) VALUES('why', 18);
INSERT INTO `students` (name, age) VALUES('tom', 22);
INSERT INTO `students` (name, age) VALUES('lilei', 25);
INSERT INTO `students` (name, age) VALUES('lucy', 16);
INSERT INTO `students` (name, age) VALUES('lily', 20);

INSERT INTO `courses` (name, price) VALUES ('è‹±è¯­', 100);
INSERT INTO `courses` (name, price) VALUES ('è¯­æ–‡', 666);
INSERT INTO `courses` (name, price) VALUES ('æ•°å­¦', 888);
INSERT INTO `courses` (name, price) VALUES ('å†å²', 80);
INSERT INTO `courses` (name, price) VALUES ('ç‰©ç†', 888);
INSERT INTO `courses` (name, price) VALUES ('åœ°ç†', 333);
```

å»ºç«‹å…³ç³»è¡¨

> è®¾è®¡åˆ°å¤šå¯¹å¤šå…³ç³»æ—¶ï¼Œå¯ä»¥æ·»åŠ ä¸€ä¸ªä¸­é—´çš„å…³ç³»è¡¨ï¼Œé€šè¿‡è®¾ç½®å¤šä¸ªå¤–é”®æ¥çº¦æŸã€‚

```sql
# 2.å»ºç«‹å…³ç³»è¡¨
CREATE TABLE IF NOT EXISTS `students_select_courses`(
	id INT PRIMARY KEY AUTO_INCREMENT,
	student_id INT NOT NULL,
	course_id INT NOT NULL,
	FOREIGN KEY (student_id) REFERENCES students(id) ON UPDATE CASCADE,
	FOREIGN KEY (course_id) REFERENCES courses(id) ON UPDATE CASCADE
);

# 3.å­¦ç”Ÿé€‰è¯¾
# whyé€‰æ‹©äº†è‹±æ–‡ã€æ•°å­¦ã€å†å²
INSERT INTO `students_select_courses` (student_id, course_id) VALUES (1, 1);
INSERT INTO `students_select_courses` (student_id, course_id) VALUES (1, 3);
INSERT INTO `students_select_courses` (student_id, course_id) VALUES (1, 4);


INSERT INTO `students_select_courses` (student_id, course_id) VALUES (3, 2);
INSERT INTO `students_select_courses` (student_id, course_id) VALUES (3, 4);

INSERT INTO `students_select_courses` (student_id, course_id) VALUES (5, 2);
INSERT INTO `students_select_courses` (student_id, course_id) VALUES (5, 3);
INSERT INTO `students_select_courses` (student_id, course_id) VALUES (5, 4);
```

:turtle: è¿™ç§æƒ…å†µä¸‹ä½¿ç”¨è”åˆä¸»é”®ä¼šæ›´åŠ åˆç†ï¼Œè¿™å¯ä»¥é¿å…å¤šæ¬¡æ’å…¥ç›¸åŒçš„æ•°æ®ï¼Œå¦‚æ’å…¥ä¸¤æ¬¡whyé€‰æ‹©æ•°å­¦ã€‚



##### æŸ¥è¯¢æ¡ˆä¾‹

```sql
# 4.æŸ¥è¯¢çš„éœ€æ±‚
# 4.1. æŸ¥è¯¢æ‰€æœ‰æœ‰é€‰è¯¾çš„å­¦ç”Ÿï¼Œé€‰æ‹©äº†å“ªäº›è¯¾ç¨‹(åœ¨å†…è¿æ¥çš„ç»“æœä¸Šï¼Œå†æ¬¡å†…è¿æ¥)
SELECT stu.id id, stu.name stuName, stu.age stuAge, cs.id csId, cs.name csName, cs.price csPrice
FROM `students` stu
JOIN `students_select_courses` ssc ON stu.id = ssc.student_id
JOIN `courses` cs ON ssc.course_id = cs.id;

# 4.2. æŸ¥è¯¢æ‰€æœ‰çš„å­¦ç”Ÿçš„é€‰è¯¾æƒ…å†µ
SELECT stu.id id, stu.name stuName, stu.age stuAge, cs.id csId, cs.name csName, cs.price csPrice
FROM `students` stu
LEFT JOIN `students_select_courses` ssc ON stu.id = ssc.student_id
LEFT JOIN `courses` cs ON ssc.course_id = cs.id;

# 4.3. å“ªäº›å­¦ç”Ÿæ˜¯æ²¡æœ‰é€‰è¯¾
SELECT stu.id id, stu.name stuName, stu.age stuAge, cs.id csId, cs.name csName, cs.price csPrice
FROM `students` stu
LEFT JOIN `students_select_courses` ssc ON stu.id = ssc.student_id
LEFT JOIN `courses` cs ON ssc.course_id = cs.id
WHERE cs.id IS NULL;

# 4.4. æŸ¥è¯¢å“ªäº›è¯¾ç¨‹æ˜¯æ²¡æœ‰è¢«é€‰æ‹©çš„
SELECT stu.id id, stu.name stuName, stu.age stuAge, cs.id csId, cs.name csName, cs.price csPrice
FROM `students` stu
RIGHT JOIN `students_select_courses` ssc ON stu.id = ssc.student_id
RIGHT JOIN `courses` cs ON ssc.course_id = cs.id
WHERE stu.id IS NULL;;

# 4.5. æŸ¥è¯¢æŸä¸€ä¸ªå­¦ç”Ÿçš„é€‰è¯¾æƒ…å†µ
SELECT stu.id id, stu.name stuName, stu.age stuAge, cs.id csId, cs.name csName, cs.price csPrice
FROM `students` stu
LEFT JOIN `students_select_courses` ssc ON stu.id = ssc.student_id
LEFT JOIN `courses` cs ON ssc.course_id = cs.id
WHERE stu.id = 2;
```

:turtle: åˆ«åè¯­æ³•ä¸­é—´çš„ `AS` åœ¨å¤§éƒ¨åˆ†æƒ…å†µéƒ½å¯ä»¥çœç•¥ï¼›

:turtle: ä½¿ç”¨ `WHERE` æ¡ä»¶ç­›é€‰æ—¶ï¼Œæ¡ä»¶å†…å®¹ä¸èƒ½åŒ…å«åˆ«åã€‚



#### å¯¹è±¡å’Œæ•°ç»„ç±»å‹

```sql
# å°†è”åˆæŸ¥è¯¢åˆ°çš„æ•°æ®è½¬æˆå¯¹è±¡ï¼ˆé€‚åˆäºä¸€å¯¹å¤šï¼‰
SELECT 
	products.id id, products.title title, products.price price,
	JSON_OBJECT('id', brand.id, 'name', brand.name, 'website', brand.website) brand
FROM `products`
LEFT JOIN `brand` ON products.brand_id = brand.id;

# å°†æŸ¥è¯¢åˆ°çš„å¤šæ¡æ•°æ®ï¼Œç»„ç»‡æˆå¯¹è±¡ï¼Œæ”¾å…¥åˆ°ä¸€ä¸ªæ•°ç»„ä¸­(é€‚åˆäºå¤šå¯¹å¤š)
SELECT 
	stu.id, stu.name, stu.age,
	JSON_ARRAYAGG(JSON_OBJECT('id', cs.id, 'name', cs.name, 'price', cs.price)) courses
FROM `students` stu
JOIN `students_select_courses` ssc ON stu.id = ssc.student_id
JOIN `courses` cs ON ssc.course_id = cs.id
GROUP BY stu.id;
```

:ghost:  `JSON_OBJECT` æ¥æ”¶å‚æ•°çš„å½¢å¼ï¼šé”®ã€å€¼ã€é”®ã€å€¼...

:ghost: ç¬¬äºŒä¸ªä¾‹å­ï¼Œç”¨äºå°†åŒä¸€åˆ†ç»„ä¸‹ï¼Œæ‰€æœ‰çš„è®°å½•åˆå¹¶ä¸ºä¸€æ¡ï¼ŒåŒä¸€è®°å½•ä¸‹çš„æŒ‡å®šå­—æ®µåˆå¹¶åˆ°å¯¹è±¡ä¸­ï¼Œæœ€ç»ˆç»„æˆå¯¹è±¡æ•°ç»„ã€‚

![image-20220702164556623](D:\ç¬”è®°\æŠ€æœ¯æ²‰æ·€ï¼ˆåç«¯ï¼‰\node\img\æ•°ç»„ç±»å‹)





## Nodeä¸­ä½¿ç”¨MYSQL

```elm
npm intall mysql2
```

> mysql2ï¼šåœ¨mysqlçš„åŸºç¡€ä¹‹ä¸Šï¼Œè¿›è¡Œäº†å¾ˆå¤šçš„ä¼˜åŒ–ã€æ”¹è¿›ï¼›

- æ›´é«˜çš„æ€§èƒ½
- é¢„ç¼–è¯‘è¯­å¥
  - å°†è¯­å¥æ¨¡å—å‘é€ç»™MySQLï¼Œè®©å®ƒç¼–è¯‘ï¼ˆè§£æã€ä¼˜åŒ–ã€è½¬æ¢ï¼‰è¯­å¥æ¨¡å—ï¼Œ<span style="color: #ff0000">å†æ¬¡æ‰§è¡Œ</span>è¯­å¥æ—¶å°±ä¸ç”¨ç¼–è¯‘ï¼›
  - é˜²æ­¢SQLæ³¨å…¥ã€‚å¦‚æ’å…¥ `or 1 = 1`  æ¥å¾—åˆ°éœ€è¦æ­£ç¡®è´¦å·å¯†ç æ‰èƒ½è¿›è¡Œçš„æŸ¥è¯¢ï¼›
  - æ”¯æŒ promise



### mysql2-åŸºæœ¬ä½¿ç”¨

#### æ™®é€šè¯­æ³•

```javascript
const mysql = require('mysql2');

// 1.åˆ›å»ºæ•°æ®åº“è¿æ¥
const connection = mysql.createConnection({
  host: 'localhost',
  port: 3306,
  database: 'xxx',
  user: 'root',
  password: 'xxx'
});

// 2.æ‰§è¡ŒSQLè¯­å¥
const statement = `
  SELECT * FROM products WHERE price > 6000;
`

connection.query(statement, (err, results, fields) => {
  console.log(results);
  connection.end() // å¯ä»¥å…³é—­å¯¹æ•°æ®åº“çš„è¿æ¥
})
```

<span style="color: #f7534f;font-weight:600">connection.query</span> æ¥æ”¶ä¸‰ä¸ªå‚æ•°ï¼šé”™è¯¯å¯¹è±¡ã€ç»“æœã€å­—æ®µå



#### ç¼–è¯‘è¯­æ³•

```javascript
// 2.æ‰§è¡ŒSQLè¯­å¥
const statement = `
  SELECT * FROM products WHERE price > ? AND score > ?;
`

connection.execute(statement, [6000, 7], (err, results, fields) => {
  console.log(results);
})
```

:ghost: <span style="color: #a50">execute</span> ç›¸å½“äºåœ¨å†…éƒ¨åŒæ—¶æ‰§è¡Œäº† prepare å’Œ query æ–¹æ³•ã€‚

 

#### æœŸçº¦å½¢å¼

```javascript
// 2.æ‰§è¡ŒSQLè¯­å¥
const statement = `
  SELECT * FROM products WHERE price > ? AND score > ?;
`

connection.promise.execute(statement, [6000, 7]).then([result, fields]) => {
  console.log(result);
})
```



#### è¿æ¥æ± 

> å‰é¢æˆ‘ä»¬æ˜¯åˆ›å»ºäº†ä¸€ä¸ªè¿æ¥ï¼ˆconnectionï¼‰ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬æœ‰å¤šä¸ªè¯·æ±‚çš„è¯ï¼Œè¯¥è¿æ¥å¾ˆæœ‰å¯èƒ½æ­£åœ¨è¢«å ç”¨ã€‚
>
> è¿æ¥æ± å¯ä»¥åœ¨éœ€è¦çš„æ—¶å€™è‡ªåŠ¨åˆ›å»ºè¿æ¥ï¼Œå¹¶ä¸”åˆ›å»ºçš„è¿æ¥<span style="color: #ff0000">ä¸ä¼šè¢«é”€æ¯</span>ï¼Œä¼šæ”¾åˆ°è¿æ¥æ± ä¸­ï¼Œ<span style="color: #ff0000">åç»­å¯ä»¥ç»§ç»­ä½¿ç”¨</span>

```javascript
const mysql = require('mysql2');

// 1.åˆ›å»ºæ•°æ®åº“è¿æ¥
const connections = mysql.createPool({
  host: 'localhost',
  port: 3306,
  database: 'xxx',
  user: 'root',
  password: 'xxx',
  connectionLimit: 10 // æœ€å¤šå»ºç«‹çš„è¿æ¥æ•°é‡
});

// 2.ä½¿ç”¨è¿æ¥æ± 
const statement = `
  SELECT * FROM products WHERE price > ? AND score > ?;
`

connections.execute(statement, [6000, 7], (err, results, fields) => {
  console.log(result);
})
```

:turtle: è¿æ¥æ± å¯ä»¥ç›´æ¥åƒè¿æ¥ä¸€æ ·ç›´æ¥ä½¿ç”¨ï¼Œå®ƒä¼šæ‰¾åˆ°ç©ºé—²çš„è¿æ¥ï¼Œç»§ç»­æ¥ä¸‹æ¥çš„æ“ä½œã€‚



### ORM

![](D:\ç¬”è®°\æŠ€æœ¯æ²‰æ·€ï¼ˆåç«¯ï¼‰\node\img\orm)



### sequelize-åŸºæœ¬ä½¿ç”¨

```elm
npm install mysql2 sequelize
```

>  sequelize çš„ä½¿ç”¨äºä¾èµ– mysql2

```javascript
const { Sequelize } = require('sequelize');

const sequelize = new Sequelize('kuming', 'root', 'mima', {
  host: 'localhost',
  dialect: 'mysql'
})

sequelize.authenticate().then(() => {
  console.log("è¿æ¥æ•°æ®åº“æˆåŠŸ");
}).catch(err => {
  console.log("è¿æ¥æ•°æ®åº“å¤±è´¥", err)
})
```

> `kuming` å¯¹åº”æ•°æ®åº“çš„åç§°ï¼Œ`mima` å¯¹åº”ç›¸åº”çš„å¯†ç ã€‚ 



#### å•è¡¨æ“ä½œ

```javascript
const { Sequelize, DataTypes, Model, Op } = require('sequelize');

const sequelize = new Sequelize("xxx", 'root', 'xxx', {
  host: 'localhost',
  dialect: 'mysql'
})

// åˆ›å»ºä¸€ä¸ªç±»ï¼Œç”¨äºæ˜ å°„åˆ°ä¸€ä¸ªè¡¨ä¸Š
class Product extends Model {}
// æ ¹æ®è¡¨çš„å­—æ®µé…ç½®ï¼Œåˆå§‹åŒ–è¿™ä¸ªç±»
Product.init({
  id: {
    type: DataTypes.INTEGER, // å¯¹åº”å­—æ®µç±»å‹
    primaryKey: true,
    autoIncrement: true
  },
  title: {
    type: DataTypes.STRING,
    allowNotNull: false
  },
  price: DataTypes.DOUBLE,
  score: DataTypes.DOUBLE
}, {
  tableName: 'products', // å¯¹åº”çš„è¡¨å
  createdAt: false, // é»˜è®¤è¡¨ä¸­ä¼šæœ‰ä¸€ä¸ª createdAtï¼Œå¦‚æœæ²¡æœ‰ï¼Œéœ€è¦è¿™æ ·é…ç½®
  updatedAt: false, // é»˜è®¤è¡¨ä¸­ä¼šæœ‰ä¸€ä¸ª updatedAtï¼Œå¦‚æœæ²¡æœ‰ï¼Œéœ€è¦è¿™æ ·é…ç½®
  sequelize
});


async function queryProducts() {
  // 0.æŸ¥è¯¢æ‰€æœ‰è®°å½•
  const result = await Product.findAll();
    
  // 1.æŸ¥è¯¢ä»·æ ¼å¤§äº5000çš„è®°å½•
  const result1 = await Product.findAll({
    where: {
      price: {
        [Op.gte]: 5000
      }
    }
  });

  // 2.æ’å…¥æ•°æ®
  const result2 = await Product.create({
    title: "ä¸‰æ˜ŸNova",
    price: 8888,
    score: 5.5
  });

  // 3.æ›´æ–°æ•°æ®
  const result3 = await Product.update({
    price: 3688
  }, {
    where: {
      id: 1
    }
  });
}

queryProducts(); // æ‰§è¡Œæ–¹æ³•
```



#### ä¸€å¯¹å¤šæ“ä½œ

```javascript
const { Sequelize, DataTypes, Model, Op } = require('sequelize');

const sequelize = new Sequelize("xxx", 'root', 'xxx', {
  host: 'localhost',
  dialect: 'mysql'
});

class Brand extends Model {};
Brand.init({
  id: {
    type: DataTypes.INTEGER,
    primaryKey: true,
    autoIncrement: true
  },
  name: {
    type: DataTypes.STRING,
    allowNotNull: false
  },
  website: DataTypes.STRING,
  phoneRank: DataTypes.INTEGER
}, {
  tableName: 'brand',
  createdAt: false,
  updatedAt: false,
  sequelize
});

class Product extends Model {}
Product.init({
  id: {
    type: DataTypes.INTEGER,
    primaryKey: true,
    autoIncrement: true
  },
  title: {
    type: DataTypes.STRING,
    allowNotNull: false
  },
  price: DataTypes.DOUBLE,
  score: DataTypes.DOUBLE,
  brandId: {
    field: 'brand_id', // æ˜ å°„è¡¨çš„è¯¥å­—æ®µ
    type: DataTypes.INTEGER,
    references: {
      model: Brand, // å…³è”çš„è¡¨
      key: 'id'
    }
  }
}, {
  tableName: 'products',
  createdAt: false,
  updatedAt: false,
  sequelize
});

// å°†ä¸¤å¼ è¡¨è”ç³»åœ¨ä¸€èµ·ï¼ˆä¸»ä»å…³ç³»ï¼‰
Product.belongsTo(Brand, {
  foreignKey: 'brandId'
});

async function queryProducts() {
  // è·å–æ‰€æœ‰è®°å½•ï¼ŒåŒæ—¶åŒ…å«ä»è¡¨çš„ä¿¡æ¯ï¼ˆè”åˆï¼‰
  const result = await Product.findAll({
    include: {
      model: Brand
    }
  });
  console.log(result);
}

queryProducts();
```



#### å¤šå¯¹å¤šæ“ä½œ

```javascript
const { Sequelize, DataTypes, Model, Op } = require('sequelize');

const sequelize = new Sequelize("xxx", 'root', 'xxx', {
  host: 'localhost',
  dialect: 'mysql'
});

// Student
class Student extends Model {}
Student.init({
  id: {
    type: DataTypes.INTEGER,
    primaryKey: true,
    autoIncrement: true
  },
  name: {
    type: DataTypes.STRING,
    allowNotNull: false
  },
  age: DataTypes.INTEGER
}, {
  tableName: 'students',
  createdAt: false,
  updatedAt: false,
  sequelize
});

// Course
class Course extends Model {}
Course.init({
  id: {
    type: DataTypes.INTEGER,
    primaryKey: true,
    autoIncrement: true
  },
  name: {
    type: DataTypes.STRING,
    allowNotNull: false
  },
  price: DataTypes.DOUBLE
}, {
  tableName: 'courses',
  createdAt: false,
  updatedAt: false,
  sequelize
});

// StudentCourse
class StudentCourse extends Model {}
StudentCourse.init({
  id: {
    type: DataTypes.INTEGER,
    primaryKey: true,
    autoIncrement: true
  },
  studentId: {
    type: DataTypes.INTEGER,
    references: {
      model: Student,
      key: 'id'
    },
    field: 'student_id'
  },
  courseId: {
    type: DataTypes.INTEGER,
    references: {
      model: Course,
      key: 'id'
    },
    field: 'course_id'
  }
}, {
  tableName: 'students_select_courses',
  createdAt: false,
  updatedAt: false,
  sequelize
});

/* å¤šå¯¹å¤šå…³ç³»çš„è”ç³» */
Student.belongsToMany(Course, {
  through: StudentCourse, // å…³è”è¡¨
  foreignKey: 'studentId',
  otherKey: 'courseId'
});

Course.belongsToMany(Student, {
  through: StudentCourse, // å…³è”è¡¨
  foreignKey: 'courseId',
  otherKey: 'studentId'
});

async function queryProducts() {
  const result = await Student.findAll({
    include: {
      model: Course
    }
  });
  console.log(result);
}

queryProducts();
```



## MYSQL

### MYSQLè¯­å¥çš„å¸¸ç”¨è§„èŒƒ 

- é€šå¸¸å…³é”®å­—æ˜¯å¤§å†™çš„ï¼Œå¦‚CREATEã€TABLEï¼› 

- è¯­å¥ä»¥ `;` ç»“å°¾ï¼› 

- å¦‚æœé‡åˆ°å…³é”®å­—ä½œä¸ºè¡¨åæˆ–è€…å­—æ®µåç§°ï¼Œå¯ä»¥ä½¿ç”¨ `` åŒ…è£¹;



### MYSQLå¸¸ç”¨æ•°æ®ç±»å‹

| æ•°å­—ç±»å‹ | å­—æ®µ            | è¯´æ˜                                        |
| -------- | ------------- | ----------------------------------------- |
| æ•´æ•°     | TINYINTï¼ŒSMALLINTï¼ŒMEDIUMINTï¼Œ<span style="color: #ff0000">INT</span>ï¼ŒBIGINT |  |
| æµ®ç‚¹æ•°   | FLOATï¼ŒDOUBLE | 4å­—èŠ‚ï¼Œ8å­—èŠ‚                              |
| ç²¾ç¡®æ•°   | DECIMALï¼ŒNUMERIC | DECIMALæ›´å¸¸ç”¨ |

| æ—¥æœŸç±»å‹            | å­—æ®µ                                          | è¯´æ˜                                       |
| ------------------- | --------------------------------------------- | ------------------------------------------ |
| YYYY                | YEAR                                          |                                            |
| YYYY-MM-DD          | DATE                                          |                                            |
| YYYY-MM-DD hh:mm:ss | DATETIME                                      | 1000-01-01 00:00:00 åˆ° 9999-12-31 23:59:59 |
| YYYY-MM-DD hh:mm:ss | <span style="color: #ff0000">TIMESTAMP</span> | 1970-01-01 00:00:01 åˆ° 2038-01-19 03:14:07 |

:whale: DATETIME æˆ– TIMESTAMP å€¼ä¹Ÿå¯ä»¥åŒ…æ‹¬å¾®ç§’ï¼ˆ6ä½ï¼‰ç²¾åº¦ã€‚

| å­—ç¬¦ä¸²ç±»å‹                  | å­—æ®µ                                        | è¯´æ˜                           |
| --------------------------- | ------------------------------------------- | ------------------------------ |
| å›ºå®šé•¿åº¦ï¼ˆ0-255ï¼‰           | CHAR                                        | åœ¨è¢«æŸ¥è¯¢æ—¶ï¼Œä¼šåˆ é™¤åé¢çš„ç©ºæ ¼   |
| å¯å˜é•¿åº¦çš„å­—ç¬¦ä¸²ï¼ˆ0-65535ï¼‰ | <span style="color: #ff0000">VARCHAR</span> | åœ¨è¢«æŸ¥è¯¢æ—¶ï¼Œä¸ä¼šåˆ é™¤åé¢çš„ç©ºæ ¼ |
| å­˜å‚¨å¤§çš„å­—ç¬¦ä¸²ç±»å‹          | TEXT                                        |                                |
| å­˜å‚¨äºŒè¿›åˆ¶å­—ç¬¦ä¸²            | BINARYï¼ŒVARBINARY                           | å°‘ç”¨ï¼Œä¸€èˆ¬å­˜å‚¨åœ¨æ–‡ä»¶ç³»ç»Ÿ       |
| å­˜å‚¨å¤§çš„äºŒè¿›åˆ¶ç±»å‹          | BLOB                                        | å°‘ç”¨ï¼Œä¸€èˆ¬å­˜å‚¨åœ¨æ–‡ä»¶ç³»ç»Ÿ       |



### MYSQLè¡¨çº¦æŸ

| è¯´æ˜     | å…³é”®å­—         | è¯´æ˜                                 |
| -------- | -------------- | ------------------------------------ |
| ä¸»é”®     | PRIMARY KEY    | ç”¨äºè¡¨ç¤ºè®°å½•çš„å”¯ä¸€æ€§ï¼Œä¸é‡å¤ä¸”ä¸ä¸ºç©º |
| å”¯ä¸€     | UNIQUE         | ä¸ä¼šé‡å¤ï¼Œä½†å…è®¸ä¸ºå¤šä¸ªNULL           |
| éç©º     | NOT NULL       |                                      |
| é»˜è®¤å€¼   | DEFAULT        |                                      |
| è‡ªåŠ¨é€’å¢ | AUTO_INCREMENT |                                      |

:turtle: ä¸»é”®ä¹Ÿå¯ä»¥æ˜¯å¤šåˆ—ç´¢å¼•ï¼Œå³è”åˆä¸»é”®ï¼›

:turtle: å¯ä»¥åŒæ—¶è®¾ç½® `UNIQUE` å’Œ `NOT NULL`ï¼Œè¡¨ç¤ºå€¼å¿…é¡»è®¾ç½®ä¸”ä¸èƒ½é‡å¤ã€‚



### MYSQLæŸ¥è¯¢æ ¼å¼

```sql
SELECT select_expr [, select_expr]...  // æŸ¥è¯¢å­—æ®µ
    [FROM table_references]            // ä»å“ªä¸ªè¡¨
    [WHERE where_condition]            // æ¡ä»¶
    [ORDER BY expr [ASC | DESC]]       // å‡åºæˆ–é™åº
    [LIMIT {[offset,] row_count | row_count OFFSET offset}]  // åç§»é‡åŠæ•°é‡
    [GROUP BY expr]
    [HAVING where_condition]
```






















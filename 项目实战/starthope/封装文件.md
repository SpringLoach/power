## 文件

 ### 登录相关方法

`app.js`

> 提供了保存登录数据（分别为Token和State）到缓存、从缓存获取登录数据、清空登录缓存的方法。
>
> 除此之外，还提供了获取根路径（区分于主机名）、判断是否登录、退出登录的方法。
>
> 最终导出并（在 `main.js`）赋值到 Vue 原型的某个属性上。



## 框架使用

### 请求表单转本地表单

1. 遍历本地表单的项，如果请求的表单中有该项，就推入到新表单中
2. 拼接一段服务器路径到表单的图片路径上
3. 将新表单赋值给本地表单

```js
/* domain为请求到的表单， me.userInfo为本地表单 */
me.userInfo = formHelper.dbToForm(domain, me.userInfo);
```

```js
const dbToForm = function(dbFrom, contextForm) {
	let newForm = {};
	for (let p in contextForm) {
		if (dbFrom[p] !== undefined) {
			newForm[p] = dbFrom[p];
		}
	}

	newForm.relativeIamge = baseConfig.getServicePath() + newForm.relativeIamge;
	return newForm;
};
```

```javascript
const ServicesBasePath = 'http://localhost:8080';
// 工程名
const ContextPath = 'job_service_platform';

/* 网址 + 项目名称 */
const getServicePath = function(){
	var baseServicesBasePath = this.ServicesBasePath;
    
	baseServicesBasePath = baseServicesBasePath + "/";
	// 如果以双斜杠作为末尾,将双斜杠转换为单斜杠
	baseServicesBasePath = baseServicesBasePath.replace(/\/{2}$/g, "/");
    
    // （存在工程名时）拼接工程名
	if(this.ContextPath&&this.ContextPath!=""){
		return baseServicesBasePath+this.ContextPath + "/";
	}
	return baseServicesBasePath;
};
```



### 请求列表转本地列表

> `prepareRender` 在将请求数据推入到 `pager.rows` 前发生，该 `pager` 指代本地 `pager`  的具体某项，如 `default` 。

```javascript
prepareRender(data) {
  data = formHelper.dbToList(data);
  return data;
},
```

```javascript
const dbToList = function(list) {
  /* 这里添加了额外属性，预处理某属性 */
  /* 除此之外，还可以转化数据格式、拼接图片路径等 */
  for (var i = 0; i < list.content.rows.length; i++) {
    list.content.rows[i]['selected'] = false;
    if (list.content.rows[i].cell.TIME != undefined &&
        list.content.rows[i].cell.TIME != "") {
        list.content.rows[i].cell.TIME = list.content.rows[i].cell.TIME.substr(0, 10);
    }
  }
  return list;
};
```



### 请求表单项的转化

> 推测：从后端请求到的表单地址不能直接用于显示，需要找到对应映射。

```javascript
/* 请求表单数据的成功回调的一部分 */
for(var i=0;i<me.pageData.addressList.length;i++){    
  if(me.userInfo.address === me.pageData.addressList[i].value){
    me.userInfo.address = me.pageData.addressList[i].label;
    break;
  }
}
/* created 的一部分 */
pageHelper.loadCodes({
  context: me,
  multipleCodeStr: "city_location",
  success(codesJson) {
    pageHelper.initPageDataItem(me.pageData.addressList, codesJson, "city_location", false);
  }
});
```



### 请求数据的多项转码

> `me.queryData` 里的数据从编码表查询到。本质就是将这些值转自身映射的其他值。

```javascript
success: function(data) {
  let ruleList = [];
  name = "unitNature, companySize, industry, area";
  ruleList.push(me.queryData.organizationList, me.queryData.companySizeList, me.queryData
.industryTypeList,me.queryData.areaList);
  let newData = formHelper.dbToCode(data, name, ruleList);
  me.companyData = newData.content.domain;
}
```

```javascript
const dbToCode = function(data, name, ruleList) {
  let list = [];
  list = data.content.domain;
  var nameList = name.split(",");
  for (var i = 0; i < nameList.length; i++) {
    for (var j = 0; j < ruleList[i].length; j++) {
      if (list[nameList[i]] == ruleList[i][j].value) {
        // 栗子: list[nameList[i]] 最终转化为 companyData.unitNature 并保存到组件中
        list[nameList[i]] = ruleList[i][j].name;
       break;
      }
    }
  }
  return data;
};
```

### 复杂的数据转化

`jobDetail.vue`

1. 需要将请求数据多次[数据转码](#请求数据的多项转码)，因为属性的层级不一样，有的内嵌多一层。可以多传入一个字符串代表层级的不同，每个层级进行一次数据转码。
2. 需要将请求数据的某些属性转化格式，或（给图片）拼接路径

3. 根据级联选择器的id等请求其文字











